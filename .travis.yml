language: java

cache:
  directories:
    - $HOME/.m2/repository

script: true
install: true

stages:
  - build
  - test
  - integration-test
  - acceptance-test

jobs:
  include:
    - stage: build
      script:
        - mvn clean test-compile --settings "settings.xml"
    - stage: test
      script:
        - mvn test --settings "settings.xml"
    - stage: integration-test
      sudo: required
      services:
        - docker
      script:
        - mvn verify -Pintegration-test --settings "settings.xml"
    - stage: acceptance-test
      script:
        - mvn verify -Pacceptance-test --settings "settings.xml"
    - stage: coverage
      sudo: required
      services:
        - docker
      script:
        - mvn verify -Dskip.unit.tests=false -Dskip.integration.tests=false -Dskip.acceptance.tests=false jacoco:report coveralls:report --settings "settings.xml"

after_success:
#- mvn deploy --settings "./settings.xml"
